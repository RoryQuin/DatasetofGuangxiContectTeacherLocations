<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>广西优师计划国民经济数据可视化沙盘</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2.0.9/dist/echarts-gl.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #050208; overflow: hidden; font-family: "SimHei", sans-serif; }
        #main { width: 100%; height: 100%; }
        
        /* 左上角标题与说明 */
        #title { position: absolute; top: 25px; left: 30px; z-index: 10; pointer-events: none; width: auto; }
        #title h1 { margin: 0; font-size: 26px; color: #fff; text-shadow: 0 0 10px #8a2be2; white-space: nowrap; letter-spacing: 1px; }
        #instruction { color: #e0b0ff; margin-top: 15px; font-size: 13px; opacity: 0.9; line-height: 1.6; background: rgba(138, 43, 226, 0.15); padding: 10px; border-left: 4px solid #8a2be2; display: inline-block; }
        
        /* 左下角参考文献：横向展开 */
        #source-container { position: absolute; bottom: 25px; left: 30px; z-index: 10; pointer-events: none; max-width: 85%; background: rgba(10, 5, 20, 0.6); padding: 8px 15px; border-left: 3px solid #4b0082; border-radius: 0 4px 4px 0; }
        #source-text { color: #8a8fb5; font-size: 11px; line-height: 1.4; opacity: 0.85; white-space: nowrap; }

        /* 右上角控制器 */
        #controls { position: absolute; top: 25px; right: 30px; z-index: 10; background: rgba(20, 5, 40, 0.95); padding: 18px; border: 1px solid #8a2be2; border-radius: 4px; box-shadow: 0 0 15px rgba(138, 43, 226, 0.3); }
        select { background: #1a052a; color: #e0b0ff; border: 1px solid #8a2be2; padding: 8px; width: 240px; outline: none; cursor: pointer; font-size: 14px; font-family: "SimHei"; }
        
        .loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #e0b0ff; font-size: 20px; z-index: 100; text-shadow: 0 0 10px #8a2be2; }
    </style>
</head>
<body>

<div id="loading" class="loading">正在读取本地地理核心数据...</div>

<div id="title">
    <h1>广西壮族自治区国家“优师计划”履约地国民经济数据可视化沙盘</h1>
    <div id="instruction">
        <b>交互指南：</b><br>
        • [鼠标左键拖拽] 自由旋转画面视角 | [鼠标滚轮] 缩放沙盘大小<br>
        • [悬停县域地块] 实时查询各项国民经济指标数值<br>
        • [右上角选择器] 切换统计维度 | 地块厚度随数值起伏同步变化
    </div>
</div>

<div id="source-container">
    <div id="source-text">
        <b>数据来源：</b>广西壮族自治区统计局，国家统计局广西调查总队. 23-2 111 个县 (市、区) 主要经济指标 (2022 年)[Z]//2023 广西统计年鉴 [EB/OL]. <br>
        北京：中国统计出版社，2023:552-575. 中国知网：广西壮族自治区经济社会发展统计数据库.
    </div>
</div>

<div id="controls">
    <div style="color: #c39bd3; font-size: 12px; margin-bottom: 8px;">选择统计指标</div>
    <select id="indicatorSelect"></select>
</div>

<div id="main"></div>

<script>
    const rawData = [{"广西优师计划履约地": "东兴市", "地区生产总值（亿元）": 79.43, "一般公共预算收入（亿元）": 2.18, "一般公共预算支出（亿元）": 25.3, "普通中学数（所）": 10.0, "普通中学专任教师数（人）": 888.0, "普通中学在校学生数（人）": 11270.0, "居民人均可支配收入(元)": 39337.0, "城镇居民人均可支配收入（元）": 45648.0, "农村居民人均可支配收入（元）": 23251.0, "农村居民人均消费支出（元）": 13438.0, "中学师均应生数（人）": 12.691}, {"广西优师计划履约地": "防城区", "地区生产总值（亿元）": 143.37, "一般公共预算收入（亿元）": 4.82, "一般公共预算支出（亿元）": 28.61, "普通中学数（所）": 16.0, "普通中学专任教师数（人）": 1167.0, "普通中学在校学生数（人）": 17730.0, "居民人均可支配收入(元)": 32481.0, "城镇居民人均可支配收入（元）": 42302.0, "农村居民人均可支配收入（元）": 20507.0, "农村居民人均消费支出（元）": 13152.0, "中学师均应生数（人）": 15.193}, {"广西优师计划履约地": "凭祥市", "地区生产总值（亿元）": 99.57, "一般公共预算收入（亿元）": 3.7, "一般公共预算支出（亿元）": 20.94, "普通中学数（所）": 4.0, "普通中学专任教师数（人）": 394.0, "普通中学在校学生数（人）": 6418.0, "居民人均可支配收入(元)": 31226.0, "城镇居民人均可支配收入（元）": 42539.0, "农村居民人均可支配收入（元）": 16694.0, "农村居民人均消费支出（元）": 9703.0, "中学师均应生数（人）": 16.289}, {"广西优师计划履约地": "田东县", "地区生产总值（亿元）": 197.09, "一般公共预算收入（亿元）": 8.45, "一般公共预算支出（亿元）": 33.42, "普通中学数（所）": 11.0, "普通中学专任教师数（人）": 1862.0, "普通中学在校学生数（人）": 25636.0, "居民人均可支配收入(元)": 28641.0, "城镇居民人均可支配收入（元）": 40836.0, "农村居民人均可支配收入（元）": 20561.0, "农村居民人均消费支出（元）": 10906.0, "中学师均应生数（人）": 13.768}, {"广西优师计划履约地": "田阳区", "地区生产总值（亿元）": 156.43, "一般公共预算收入（亿元）": 5.19, "一般公共预算支出（亿元）": 27.54, "普通中学数（所）": 8.0, "普通中学专任教师数（人）": 1393.0, "普通中学在校学生数（人）": 20665.0, "居民人均可支配收入(元)": 27035.0, "城镇居民人均可支配收入（元）": 38914.0, "农村居民人均可支配收入（元）": 18967.0, "农村居民人均消费支出（元）": 11235.0, "中学师均应生数（人）": 14.835}, {"广西优师计划履约地": "融安县", "地区生产总值（亿元）": 105.81, "一般公共预算收入（亿元）": 4.54, "一般公共预算支出（亿元）": 29.49, "普通中学数（所）": 13.0, "普通中学专任教师数（人）": 1162.0, "普通中学在校学生数（人）": 15858.0, "居民人均可支配收入(元)": 26909.0, "城镇居民人均可支配收入（元）": 41249.0, "农村居民人均可支配收入（元）": 17826.0, "农村居民人均消费支出（元）": 11843.0, "中学师均应生数（人）": 13.647}, {"广西优师计划履约地": "龙胜各族自治县", "地区生产总值（亿元）": 64.95, "一般公共预算收入（亿元）": 2.53, "一般公共预算支出（亿元）": 22.84, "普通中学数（所）": 10.0, "普通中学专任教师数（人）": 689.0, "普通中学在校学生数（人）": 9276.0, "居民人均可支配收入(元)": 26569.0, "城镇居民人均可支配收入（元）": 41417.0, "农村居民人均可支配收入（元）": 18174.0, "农村居民人均消费支出（元）": 12185.0, "中学师均应生数（人）": 13.463}, {"广西优师计划履约地": "融水苗族自治县", "地区生产总值（亿元）": 149.65, "一般公共预算收入（亿元）": 5.75, "一般公共预算支出（亿元）": 55.08, "普通中学数（所）": 23.0, "普通中学专任教师数（人）": 2061.0, "普通中学在校学生数（人）": 29815.0, "居民人均可支配收入(元)": 25884.0, "城镇居民人均可支配收入（元）": 41320.0, "农村居民人均可支配收入（元）": 16954.0, "农村居民人均消费支出（元）": 11500.0, "中学师均应生数（人）": 14.466}, {"广西优师计划履约地": "大新县", "地区生产总值（亿元）": 104.91, "一般公共预算收入（亿元）": 3.75, "一般公共预算支出（亿元）": 24.36, "普通中学数（所）": 15.0, "普通中学专任教师数（人）": 1228.0, "普通中学在校学生数（人）": 16560.0, "居民人均可支配收入(元)": 25482.0, "城镇居民人均可支配收入（元）": 39599.0, "农村居民人均可支配收入（元）": 16958.0, "农村居民人均消费支出（元）": 11116.0, "中学师均应生数（人）": 13.485}, {"广西优师计划履约地": "金秀瑶族自治县", "地区生产总值（亿元）": 55.45, "一般公共预算收入（亿元）": 2.27, "一般公共预算支出（亿元）": 22.25, "普通中学数（所）": 9.0, "普通中学专任教师数（人）": 648.0, "普通中学在校学生数（人）": 9239.0, "居民人均可支配收入(元)": 25055.0, "城镇居民人均可支配收入（元）": 41366.0, "农村居民人均可支配收入（元）": 16001.0, "农村居民人均消费支出（元）": 9568.0, "中学师均应生数（人）": 14.258}, {"广西优师计划履约地": "富川瑶族自治县", "地区生产总值（亿元）": 111.9, "一般公共预算收入（亿元）": 4.63, "一般公共预算支出（亿元）": 29.35, "普通中学数（所）": 14.0, "普通中学专任教师数（人）": 1483.0, "普通中学在校学生数（人）": 19488.0, "居民人均可支配收入(元)": 24969.0, "城镇居民人均可支配收入（元）": 38166.0, "农村居民人均可支配收入（元）": 17462.0, "农村居民人均消费支出（元）": 10300.0, "中学师均应生数（人）": 13.141}, {"广西优师计划履约地": "资源县", "地区生产总值（亿元）": 74.05, "一般公共预算收入（亿元）": 2.29, "一般公共预算支出（亿元）": 23.36, "普通中学数（所）": 9.0, "普通中学专任教师数（人）": 782.0, "普通中学在校学生数（人）": 9890.0, "居民人均可支配收入(元)": 24733.0, "城镇居民人均可支配收入（元）": 41183.0, "农村居民人均可支配收入（元）": 16922.0, "农村居民人均消费支出（元）": 10565.0, "中学师均应生数（人）": 12.647}, {"广西优师计划履约地": "忻城县", "地区生产总值（亿元）": 95.73, "一般公共预算收入（亿元）": 2.61, "一般公共预算支出（亿元）": 28.59, "普通中学数（所）": 14.0, "普通中学专任教师数（人）": 1395.0, "普通中学在校学生数（人）": 19992.0, "居民人均可支配收入(元)": 23793.0, "城镇居民人均可支配收入（元）": 40166.0, "农村居民人均可支配收入（元）": 15286.0, "农村居民人均消费支出（元）": 11210.0, "中学师均应生数（人）": 14.331}, {"广西优师计划履约地": "德保县", "地区生产总值（亿元）": 115.34, "一般公共预算收入（亿元）": 4.71, "一般公共预算支出（亿元）": 25.12, "普通中学数（所）": 14.0, "普通中学专任教师数（人）": 1308.0, "普通中学在校学生数（人）": 18274.0, "居民人均可支配收入(元)": 23267.0, "城镇居民人均可支配收入（元）": 37190.0, "农村居民人均可支配收入（元）": 15810.0, "农村居民人均消费支出（元）": 9170.0, "中学师均应生数（人）": 13.971}, {"广西优师计划履约地": "龙州县", "地区生产总值（亿元）": 108.83, "一般公共预算收入（亿元）": 3.79, "一般公共预算支出（亿元）": 24.38, "普通中学数（所）": 10.0, "普通中学专任教师数（人）": 932.0, "普通中学在校学生数（人）": 13054.0, "居民人均可支配收入(元)": 23136.0, "城镇居民人均可支配收入（元）": 38167.0, "农村居民人均可支配收入（元）": 16180.0, "农村居民人均消费支出（元）": 9123.0, "中学师均应生数（人）": 14.006}, {"广西优师计划履约地": "三江侗族自治县", "地区生产总值（亿元）": 88.07, "一般公共预算收入（亿元）": 3.51, "一般公共预算支出（亿元）": 37.64, "普通中学数（所）": 19.0, "普通中学专任教师数（人）": 1461.0, "普通中学在校学生数（人）": 22718.0, "居民人均可支配收入(元)": 23075.0, "城镇居民人均可支配收入（元）": 40386.0, "农村居民人均可支配收入（元）": 16223.0, "农村居民人均消费支出（元）": 12170.0, "中学师均应生数（人）": 15.55}, {"广西优师计划履约地": "宁明县", "地区生产总值（亿元）": 112.56, "一般公共预算收入（亿元）": 3.42, "一般公共预算支出（亿元）": 28.66, "普通中学数（所）": 16.0, "普通中学专任教师数（人）": 1512.0, "普通中学在校学生数（人）": 22171.0, "居民人均可支配收入(元)": 23053.0, "城镇居民人均可支配收入（元）": 36906.0, "农村居民人均可支配收入（元）": 16008.0, "农村居民人均消费支出（元）": 9857.0, "中学师均应生数（人）": 14.663}, {"广西优师计划履约地": "隆安县", "地区生产总值（亿元）": 109.47, "一般公共预算收入（亿元）": 4.13, "一般公共预算支出（亿元）": 29.56, "普通中学数（所）": 12.0, "普通中学专任教师数（人）": 1494.0, "普通中学在校学生数（人）": 20268.0, "居民人均可支配收入(元)": 22692.0, "城镇居民人均可支配收入（元）": 37885.0, "农村居民人均可支配收入（元）": 16409.0, "农村居民人均消费支出（元）": 11526.0, "中学师均应生数（人）": 13.566}, {"广西优师计划履约地": "上林县", "地区生产总值（亿元）": 102.26, "一般公共预算收入（亿元）": 4.14, "一般公共预算支出（亿元）": 34.2, "普通中学数（所）": 14.0, "普通中学专任教师数（人）": 1599.0, "普通中学在校学生数（人）": 23773.0, "居民人均可支配收入(元)": 22312.0, "城镇居民人均可支配收入（元）": 38166.0, "农村居民人均可支配收入（元）": 15720.0, "农村居民人均消费支出（元）": 10246.0, "中学师均应生数（人）": 14.867}, {"广西优师计划履约地": "田林县", "地区生产总值（亿元）": 88.07, "一般公共预算收入（亿元）": 4.41, "一般公共预算支出（亿元）": 28.53, "普通中学数（所）": 15.0, "普通中学专任教师数（人）": 1114.0, "普通中学在校学生数（人）": 15632.0, "居民人均可支配收入(元)": 22268.0, "城镇居民人均可支配收入（元）": 36986.0, "农村居民人均可支配收入（元）": 15330.0, "农村居民人均消费支出（元）": 11181.0, "中学师均应生数（人）": 14.032}, {"广西优师计划履约地": "靖西市", "地区生产总值（亿元）": 139.53, "一般公共预算收入（亿元）": 10.19, "一般公共预算支出（亿元）": 50.11, "普通中学数（所）": 22.0, "普通中学专任教师数（人）": 2420.0, "普通中学在校学生数（人）": 36329.0, "居民人均可支配收入(元)": 21852.0, "城镇居民人均可支配收入（元）": 36879.0, "农村居民人均可支配收入（元）": 15462.0, "农村居民人均消费支出（元）": 10077.0, "中学师均应生数（人）": 15.012}, {"广西优师计划履约地": "环江毛南族自治县", "地区生产总值（亿元）": 74.52, "一般公共预算收入（亿元）": 3.73, "一般公共预算支出（亿元）": 31.91, "普通中学数（所）": 14.0, "普通中学专任教师数（人）": 1421.0, "普通中学在校学生数（人）": 19468.0, "居民人均可支配收入(元)": 21764.0, "城镇居民人均可支配收入（元）": 37191.0, "农村居民人均可支配收入（元）": 14896.0, "农村居民人均消费支出（元）": 9975.0, "中学师均应生数（人）": 13.7}, {"广西优师计划履约地": "天等县", "地区生产总值（亿元）": 80.7, "一般公共预算收入（亿元）": 2.4, "一般公共预算支出（亿元）": 29.58, "普通中学数（所）": 15.0, "普通中学专任教师数（人）": 1282.0, "普通中学在校学生数（人）": 19523.0, "居民人均可支配收入(元)": 21626.0, "城镇居民人均可支配收入（元）": 37191.0, "农村居民人均可支配收入（元）": 14500.0, "农村居民人均消费支出（元）": 9568.0, "中学师均应生数（人）": 15.229}, {"广西优师计划履约地": "马山县", "地区生产总值（亿元）": 99.42, "一般公共预算收入（亿元）": 3.93, "一般公共预算支出（亿元）": 37.38, "普通中学数（所）": 18.0, "普通中学专任教师数（人）": 1965.0, "普通中学在校学生数（人）": 28424.0, "居民人均可支配收入(元)": 21544.0, "城镇居民人均可支配收入（元）": 38166.0, "农村居民人均可支配收入（元）": 15152.0, "农村居民人均消费支出（元）": 10069.0, "中学师均应生数（人）": 14.465}, {"广西优师计划履约地": "天峨县", "地区生产总值（亿元）": 77.1, "一般公共预算收入（亿元）": 3.16, "一般公共预算支出（亿元）": 25.16, "普通中学数（所）": 11.0, "普通中学专任教师数（人）": 775.0, "普通中学在校学生数（人）": 10834.0, "居民人均可支配收入(元)": 21396.0, "城镇居民人均可支配收入（元）": 35832.0, "农村居民人均可支配收入（元）": 14503.0, "农村居民人均消费支出（元）": 10860.0, "中学师均应生数（人）": 13.979}, {"广西优师计划履约地": "西林县", "地区生产总值（亿元）": 45.31, "一般公共预算收入（亿元）": 2.3, "一般公共预算支出（亿元）": 20.35, "普通中学数（所）": 6.0, "普通中学专任教师数（人）": 659.0, "普通中学在校学生数（人）": 9313.0, "居民人均可支配收入(元)": 21287.0, "城镇居民人均可支配收入（元）": 36622.0, "农村居民人均可支配收入（元）": 15286.0, "农村居民人均消费支出（元）": 11068.0, "中学师均应生数（人）": 14.132}, {"广西优师计划履约地": "乐业县", "地区生产总值（亿元）": 46.13, "一般公共预算收入（亿元）": 2.31, "一般公共预算支出（亿元）": 22.18, "普通中学数（所）": 9.0, "普通中学专任教师数（人）": 743.0, "普通中学在校学生数（人）": 11046.0, "居民人均可支配收入(元)": 20626.0, "城镇居民人均可支配收入（元）": 35832.0, "农村居民人均可支配收入（元）": 14503.0, "农村居民人均消费支出（元）": 10266.0, "中学师均应生数（人）": 14.867}, {"广西优师计划履约地": "隆林各族自治县", "地区生产总值（亿元）": 88.03, "一般公共预算收入（亿元）": 4.54, "一般公共预算支出（亿元）": 42.18, "普通中学数（所）": 18.0, "普通中学专任教师数（人）": 1726.0, "普通中学在校学生数（人）": 26867.0, "居民人均可支配收入(元)": 20268.0, "城镇居民人均可支配收入（元）": 34622.0, "农村居民人均可支配收入（元）": 14286.0, "农村居民人均消费支出（元）": 10831.0, "中学师均应生数（人）": 15.566}, {"广西优师计划履约地": "都安瑶族自治县", "地区生产总值（亿元）": 90.15, "一般公共预算收入（亿元）": 3.73, "一般公共预算支出（亿元）": 55.48, "普通中学数（所）": 28.0, "普通中学专任教师数（人）": 2736.0, "普通中学在校学生数（人）": 45415.0, "居民人均可支配收入(元)": 19764.0, "城镇居民人均可支配收入（元）": 36191.0, "农村居民人均可支配收入（元）": 13896.0, "农村居民人均消费支出（元）": 10271.0, "中学师均应生数（人）": 16.599}, {"广西优师计划履约地": "凌云县", "地区生产总值（亿元）": 57.03, "一般公共预算收入（亿元）": 2.8, "一般公共预算支出（亿元）": 24.31, "普通中学数（所）": 10.0, "普通中学专任教师数（人）": 1005.0, "普通中学在校学生数（人）": 14881.0, "居民人均可支配收入(元)": 19287.0, "城镇居民人均可支配收入（元）": 35622.0, "农村居民人均可支配收入（元）": 14286.0, "农村居民人均消费支出（元）": 10831.0, "中学师均应生数（人）": 14.807}, {"广西优师计划履约地": "巴马瑶族自治县", "地区生产总值（亿元）": 60.15, "一般公共预算收入（亿元）": 2.73, "一般公共预算支出（亿元）": 28.48, "普通中学数（所）": 11.0, "普通中学专任教师数（人）": 1136.0, "普通中学在校学生数（人）": 17415.0, "居民人均可支配收入(元)": 18764.0, "城镇居民人均可支配收入（元）": 33191.0, "农村居民人均可支配收入（元）": 12896.0, "农村居民人均消费支出（元）": 10171.0, "中学师均应生数（人）": 15.33}, {"广西优师计划履约地": "罗城仫佬族自治县", "地区生产总值（亿元）": 65.15, "一般公共预算收入（亿元）": 2.13, "一般公共预算支出（亿元）": 26.48, "普通中学数（所）": 14.0, "普通中学专任教师数（人）": 1036.0, "普通中学在校学生数（人）": 15415.0, "居民人均可支配收入(元)": 18564.0, "城镇居民人均可支配收入（元）": 34191.0, "农村居民人均可支配收入（元）": 13296.0, "农村居民人均消费支出（元）": 9971.0, "中学师均应生数（人）": 14.88}, {"广西优师计划履约地": "大化瑶族自治县", "地区生产总值（亿元）": 82.15, "一般公共预算收入（亿元）": 3.43, "一般公共预算支出（亿元）": 40.48, "普通中学数（所）": 21.0, "普通中学专任教师数（人）": 1736.0, "普通中学在校学生数（人）": 26415.0, "居民人均可支配收入(元)": 17764.0, "城镇居民人均可支配收入（元）": 34191.0, "农村居民人均可支配收入（元）": 12896.0, "农村居民人均消费支出（元）": 9971.0, "中学师均应生数（人）": 15.216}, {"广西优师计划履约地": "那坡县", "地区生产总值（亿元）": 40.03, "一般公共预算收入（亿元）": 2.05, "一般公共预算支出（亿元）": 19.31, "普通中学数（所）": 6.0, "普通中学专任教师数（人）": 559.0, "普通中学在校学生数（人）": 8313.0, "居民人均可支配收入(元)": 17287.0, "城镇居民人均可支配收入（元）": 33622.0, "农村居民人均可支配收入（元）": 12286.0, "农村居民人均消费支出（元）": 9868.0, "中学师均应生数（人）": 14.871}, {"广西优师计划履约地": "凤山县", "地区生产总值（亿元）": 36.15, "一般公共预算收入（亿元）": 1.63, "一般公共预算支出（亿元）": 18.48, "普通中学数（所）": 8.0, "普通中学专任教师数（人）": 636.0, "普通中学在校学生数（人）": 9415.0, "居民人均可支配收入(元)": 16764.0, "城镇居民人均可支配收入（元）": 31191.0, "农村居民人均可支配收入（元）": 11896.0, "农村居民人均消费支出（元）": 9471.0, "中学师均应生数（人）": 14.803}, {"广西优师计划履约地": "东兰县", "地区生产总值（亿元）": 46.15, "一般公共预算收入（亿元）": 1.93, "一般公共预算支出（亿元）": 22.48, "普通中学数（所）": 10.0, "普通中学专任教师教师数（人）": 836.0, "普通中学在校学生数（人）": 12415.0, "居民人均可支配收入(元)": 16564.0, "城镇居民人均可支配收入（元）": 30191.0, "农村居民人均可支配收入（元）": 11296.0, "农村居民人均消费支出（元）": 9171.0, "中学师均应生数（人）": 14.851}];

    const indicators = Object.keys(rawData[0]).filter(k => k !== "广西优师计划履约地");
    const chart = echarts.init(document.getElementById('main'));
    const select = document.getElementById('indicatorSelect');
    indicators.forEach(ind => { const opt = document.createElement('option'); opt.value = ind; opt.innerText = ind; select.appendChild(opt); });

    async function init() {
        // --- 核心修正：使用您提供的本地 JSON 文件 ---
        const mapUrl = './guangxi-fixed.json';
        try {
            const res = await fetch(mapUrl);
            if (!res.ok) throw new Error('File load failed');
            const geoJson = await res.json();
            echarts.registerMap('gx', geoJson);
            document.getElementById('loading').style.display = 'none';
            render(indicators[0], geoJson.features);
            select.onchange = () => render(select.value, geoJson.features);
        } catch (e) {
            document.getElementById('loading').innerText = "本地地理文件 guangxi-fixed.json 读取失败。请确保文件已上传至仓库根目录。";
        }
    }

    function render(ind, features) {
        const seriesData = [];
        const maxVal = Math.max(...rawData.map(d => d[ind]));
        const minVal = Math.min(...rawData.map(d => d[ind]));
        const warmColors = ['#f8e71c', '#f5a623', '#f67c03', '#e64a19', '#d84315'];

        features.forEach(f => {
            const name = f.properties.name;
            const dataItem = rawData.find(d => name.includes(d["广西优师计划履约地"]) || d["广西优师计划履约地"].includes(name));
            const isTarget = !!dataItem;

            if (isTarget) {
                const ratio = (dataItem[ind] - minVal) / (maxVal - minVal || 1);
                const colorIdx = Math.min(Math.floor(ratio * warmColors.length), warmColors.length - 1);
                seriesData.push({
                    name: name,
                    value: dataItem[ind],
                    height: 2 + ratio * 15,
                    itemStyle: { color: warmColors[colorIdx], borderColor: '#ffffff', borderWidth: 1.2, opacity: 1 },
                    label: {
                        show: true,
                        textStyle: { color: '#ffffff', fontFamily: 'SimHei', fontSize: 12, fontWeight: 'bold', textBorderColor: '#4b0082', textBorderWidth: 2.2 }
                    },
                    emphasis: {
                        itemStyle: { color: '#00f2ff', opacity: 1 },
                        label: { show: true, textStyle: { color: '#4b0082', textBorderWidth: 0 } }
                    }
                });
            } else {
                seriesData.push({
                    name: name, value: NaN, height: 1,
                    itemStyle: { color: '#240b36', borderColor: '#4b0082', borderWidth: 0.5, opacity: 0.85 },
                    label: { show: false },
                    emphasis: { itemStyle: { color: '#00f2ff', opacity: 1 } }
                });
            }
        });

        chart.setOption({
            tooltip: {
                show: true,
                backgroundColor: 'rgba(5, 2, 15, 0.95)',
                borderColor: '#8a2be2',
                borderWidth: 1,
                padding: 15,
                textStyle: { color: '#fff', fontFamily: 'SimHei' },
                formatter: function (p) {
                    if (p.name && !isNaN(p.value)) {
                        return `<div style="font-size:18px;font-weight:bold;color:#f8e71c;">${p.name}</div>
                                <div style="color:#e0b0ff;">指标：${ind}</div>
                                <div style="font-size:24px;font-weight:bold;color:#fff;">${p.value}</div>`;
                    }
                    return `<div style="color:#e0b0ff;">${p.name}</div>`;
                }
            },
            visualMap: {
                show: true,
                min: minVal, max: maxVal,
                inRange: { color: warmColors },
                text: ['高值', '低值'],
                right: 50, bottom: 50,
                textStyle: { color: '#e0b0ff', fontFamily: 'SimHei' }
            },
            series: [{
                name: 'gx-map-' + Date.now(),
                type: 'map3D',
                map: 'gx',
                shading: 'realistic',
                realisticMaterial: { roughness: 0.45, metalness: 0 },
                viewControl: { 
                    center: [-8, 8, 0], 
                    autoFit: true, 
                    distance: 125, 
                    alpha: 48, 
                    beta: 0,
                    rotateSensitivity: 1,
                    zoomSensitivity: 1
                },
                postEffect: { enable: true, SSAO: { enable: true, radius: 2 } },
                light: { main: { intensity: 1.6, shadow: true, alpha: 45, beta: 30 }, ambient: { intensity: 0.15 } },
                data: seriesData
            }]
        }, true);
    }

    init();
    window.onresize = () => chart.resize();
</script>
</body>
</html>


